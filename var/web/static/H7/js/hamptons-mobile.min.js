var signing_key=window.SETTINGS["signing_key"],username=window.SETTINGS["username"],hostname=window.SETTINGS["hostname"]||"localhost",sockURL="//{0}:9001/sandpiper".format(hostname),sandpiper=new SockJS(sockURL),framptize=function(frampton_name){return function(message){return{op:"twit",user:username,frampton:frampton_name,value:message.sign(signing_key)}}},framp=framptize("__wat__"),join=function(frampton_name){sandpiper.json({op:"join",user:username,value:frampton_name.sign(signing_key)})},quit=function(frampton_name){sandpiper.json({op:"quit",user:username,value:frampton_name.sign(signing_key)})},hamptons=new Framework7({onBeforePageInit:function(page){},onPageInit:function(page){},onPageAfterAnimation:function(page){},onPageBeforeAnimation:function(page){}}),$$$=hamptons.$,mainView=hamptons.addView(".view-main",{dynamicNavbar:true});$$$(document).on("pageInit",function(e){var page=e.detail.page;console.log("pageInit: ",page.name);$$$(".message, .messages-date").hide();if(page.name.startswith("frampton-")){window.frampton=page.name.replace(/^frampton-/,"");console.log("WE CHATTIN: ",window.frampton);join(window.frampton)}});$$$("#tweet-button").on("click",function(e){var message=$$$("#id_tweeter").val();console.log("TWEET: ",message);sandpiper.json(framp(message))});sandpiper.json=function(){return sandpiper.send(JSON.stringify(arguments[0]||{op:"noop"}))};sandpiper.onopen=function(){console.log("SANDPIPER: connected")};sandpiper.onmessage=function(e){var message=e.data,date=new Date,dateparts=date.toDateString().split(" "),timeparts=date.toTimeString().split(" "),day=dateparts[0],time=timeparts[0].split(":").slice(0,2).join(":"),payload=JSON.parse(e.data),op=payload["op"],user=payload["user"],value=payload["value"],from_op=payload["from_op"];console.log("SANDPIPER: message received");console.log("OP: <<{0}>>".format(op));console.log("USER: ",user);console.log("VALUE: ",value);console.log("FROM OP: ",from_op);switch(op){case"join":break;case"quit":break;case"omfg":hamptons.alert("SANDPIPER FREAKOUT:\n"+value);break;case"post":if(payload["frampton"]==window.frampton){hamptons.addMessage({text:value,day:day,time:time,type:user==username?"sent":"received"})}break;case"fdbk":if(from_op==="open"){sandpiper.json({op:"auth",user:username,value:signing_key})}else if(from_op==="auth"){}else if(from_op==="join"){window.frampton=value;framp=framptize(window.frampton)}else if(from_op==="quit"){window.frampton=undefined;framp=framptize("__wat__")}else if(from_op==="twit"){}break;default:console.log("UNKNOWN OP: ",op.upper());console.log("USER: ",user);console.log("VALUE: ",value);break}};sandpiper.onclose=function(){console.log("SANDPIPER: disconnected")};window.addEventListener("load",function(){window.setTimeout(function(){window.scrollTo(0,1)},0)});