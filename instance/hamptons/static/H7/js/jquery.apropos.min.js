(function($,_,T){$.extend({"new":function(elem){return $(document.createElement(elem))},querystring:function(){var querydict=arguments[0]||{},url=arguments[1]||"",omit=arguments[2]||[];return _.chain(querydict).omit(omit).pairs().sortBy(function(pair){return pair[0]}).filter(function(pair){return pair[0]!==null&&typeof pair[0]!=="undefined"}).reduce(function(memo,kv){var value=kv[1]===null||typeof kv[1]==="undefined"?"":kv[1];return"{0}&{1}={2}".format(memo,kv[0].toString().uriencode(),value.toString().uriencode())},url.suffixWith("?")).value()},dictpath:function(){var querydict=arguments[0]||{},url=arguments[1]||"",omit=arguments[2]||[];return _.chain(querydict).omit(omit).pairs().sortBy(function(pair){return pair[0]}).filter(function(pair){return pair[1]!==null&&typeof pair[1]!=="undefined"}).reduce(function(memo,pair){return"{0}/{1}".format(memo,pair[1].toString().slugify())},url.suffixWith("/")).value()},hash:function(hashable){if(typeof hashable==="undefined"){return"undefined".MD5()}if(typeof hashable==="string"){return hashable.MD5()}if(typeof hashable.elementname!=="undefined"){return hashable.elementname().MD5()}var jsonable=_.isObject(hashable)||_.isArray(hashable),functype=_.isFunction(hashable);if(jsonable&&!functype){try{return JSON.stringify(hashable).MD5()}catch(e){return hashable.toString().MD5()}}if(typeof hashable.html!=="undefined"){return hashable.html().MD5()}return hashable.toString().MD5()},default_results_examiner:function(results){var status=typeof results!=="undefined";status=status&&results!==null;status=status&&results.hasOwnProperty("status");status=status&&results["status"].toString().toLowerCase()=="ok";return status}});$.fn.extend({hash:function(){var $this=$(this),hash_memo=$this.data("apropos-hash"),hash_out=undefined;if(typeof hash_memo!=="undefined"){return hash_memo}hash_out=$.hash($this);$this.data("apropos-hash",hash_out);return hash_out},"new":function(elem_type){return $.new(elem_type).appendTo(this)},apropos:function(url_){var $that=$(this),results_examiner_func=arguments[1]||$.default_results_examiner,url_maker_func=arguments[2]||$.dictpath;this.each(function(){var $this=$(this);$this.on("apropos",function(e,options){var url=url_maker_func($that.queryopts(options),url_),url_key=$.hash(url),data=$that.data(url_key),results_are_valid=false,force=typeof options.force!=="undefined"&&options.force;if(force||typeof data==="undefined"){$.when($.getJSON(url)).done(function(apropos_results){try{results_are_valid=results_examiner_func.call($this,apropos_results)}catch(exc){results_are_valid=false}if(results_are_valid){$that.data(url_key,apropos_results["data"]);$this.triggerHandler("inquiry",[url_key,true,options])}else{$this.triggerHandler("failure",[url_key,options])}}).fail(function(xhr,status_,apropos_results){$this.triggerHandler("failure",[url_key,options])})}else{$this.triggerHandler("inquiry",[url_key,false,options])}})});return $that},WRT:function(url){var $that=$(this),results_examiner_func=arguments[1]||$.default_results_examiner;this.each(function(){var $this=$(this);$this.on("apropos",function(e,options){$.when($.post(url,$this.queryopts(options),"json")).done(function(apropos_results){var results_are_valid=false;try{results_are_valid=results_examiner_func.call($this,apropos_results)}catch(exc){results_are_valid=false}if(results_are_valid){var url_key=$.hash(url);$that.data(url_key,apropos_results["data"]);$this.triggerHandler("inquiry",[url_key,true,options])}else{$this.triggerHandler("failure",[null,options])}}).fail(function(xhr,status_,apropos_results){$this.triggerHandler("failure",[null,options])})})});return $that},inthecaseof:function(datum){var $that=$(this);this.each(function(){var $this=$(this);$this.on("apropos",function(e,options){var datum_key=$.hash(options);$that.data(datum_key,datum);$this.triggerHandler("inquiry",[datum_key,false,options])})});return $that},failure:function(failure_func){var $that=$(this);this.each(function(){var $this=$(this);$this.on("failure",function(e,url_key,options){failure_func(url_key,options)})});return $that},inanycase:function(final_func){var $that=$(this);this.each(function(){var $this=$(this),isitoveryet=function(e,url_key,options){return final_func(url_key,options)};$this.on({failure:isitoveryet,findings:isitoveryet})});return $that},defaults:function(){var $that=$(this),defaults_=arguments[0]||null,default_value=arguments[1]||null,existent=$that.data("defaults");existent=typeof existent==="object"?existent:{};if(defaults_){if(typeof defaults_==="object"){$that.data("defaults",_(existent).extend(defaults_))}else if(typeof defaults_==="string"){if(default_value){existent[defaults_]=default_value;$that.data("defaults",existent)}else{if(defaults_ in existent){return existent[defaults_]}return undefined}}}else{return existent}return $that},omit:function(){var $that=$(this),omits=arguments[0]||null,existent=$that.data("omit");existent=typeof existent==="object"?existent:[];if(omits){if(typeof omits==="object"){$that.data("omit",existent.concat(_.toArray(omits)))}else if(typeof omits==="string"){$that.data("omit",_(existent).chain().push(omits).uniq().value())}}else{return _.toArray(existent)}return $that},queryopts:function(){var $that=$(this),defaults=_.clone($that.defaults()),omit=[].concat($that.omit()),options=arguments[0]||{},union=_.defaults(options,defaults),intersection=_(union).omit(omit);return intersection},elementname:function(){var $this=$(this),id=$this.attr("id"),classes=$this.attr("class"),idname=typeof id!=="undefined"?id.toString().prefixwith("#"):undefined,classnames=typeof classes!=="undefined"?classes.split(" ").map(function(cls){return cls.prefixwith(".")}).join(""):undefined;return typeof idname!=="undefined"?idname:typeof classnames!=="undefined"?classnames:"<unknown>"},slug:function(){return $(this).elementname().slugify()},inquire:function(inquiry_func){var pre_inquiry_opts=arguments[1]||{},event_namespace=arguments[2]||"default",event_name="inquiry.{0}".format(event_namespace),$that=$(this),pre_inquiry_func;if(!_.isFunction(pre_inquiry_opts)){pre_inquiry_func=function(opts,$root){return _(pre_inquiry_opts).extend(opts)}}else{pre_inquiry_func=pre_inquiry_opts}this.each(function(){var $this=$(this);$this.on("QED",function(e,options){options=pre_inquiry_func.apply($this,[_.extend(_.clone($that.defaults()),options),$that])||options;$this.on(event_name,function(e,_key,fresh_fetch,options){var findings=inquiry_func.apply($this,[$that.data(_key),_key,fresh_fetch,options]);$this.off(event_name);$this.triggerHandler("findings",[options,findings])});console.log(">> QED ({0}): ".format($this.elementname()),options);$this.triggerHandler("apropos",[options])})});return $that},incorporate:function(template){var $that=$(this),template_func=$.template(template),pre_inquiry=arguments[1]||function(opts,$root){};return this.each(function(){var $this=$(this);$this.inquire(function(data){$this.html(template_func(data));return data},pre_inquiry)})},QED:function(){var options=arguments[0]||{},findings_callback=arguments[1]||null,$that=$(this);this.each(function(){var $this=$(this);$this.off("findings");if(findings_callback!==null){$this.on("findings",function(e,options_,findings){findings_callback.apply($this,[options_,findings]);$this.off("findings")})}$this.triggerHandler("QED",options)});return $that}});$.fn.options=$.fn.defaults;$(document).ready(function(){var $body=$("body");$("script.template").each(function(){var $template=$(this),template_key="template:{0}".format($template.slug()),template_func=T.compile($template.html());$body.data(template_key,template_func)});$.extend({template:function(elem){if(typeof elem==="string"){elem=elem.prefixwith("#")}var $elem=$(elem),template_func=$body.data("template:{0}".format($elem.slug())),existant=typeof template_func!=="undefined";if(!existant){console.log(">> UNKNOWN TEMPLATE NAME passed to $.template: ",$elem.elementname())}return existant?template_func:function(data){console.log(">> UNDEFINED TEMPLATE FUNCTION called with data: ",data,", name: ",$elem.elementname())}}})})})(jQuery,_,Handlebars);